// UiPath Invoke Code Activity
// Output argument: output (String)

DateTime startTime = DateTime.Now;
TimeSpan timeout = TimeSpan.FromMinutes(5);
bool syncCompleted = false;

try
{
    var outlookApp = new Microsoft.Office.Interop.Outlook.Application();
    var outlookNs = outlookApp.GetNamespace("MAPI");
    var syncObjects = outlookNs.SyncObjects;

    // Create a wait handle so we can block until sync ends or timeout
    System.Threading.AutoResetEvent syncDoneEvent = new System.Threading.AutoResetEvent(false);

    // Subscribe to SyncEnd events
    for (int i = 1; i <= syncObjects.Count; i++)
    {
        var syncObj = syncObjects[i];

        ((Microsoft.Office.Interop.Outlook.SyncObjectEvents_Event)syncObj).SyncEnd +=
            new Microsoft.Office.Interop.Outlook.SyncObjectEvents_SyncEndEventHandler(() =>
            {
                syncCompleted = true;
                syncDoneEvent.Set();
            });

        // Optionally trigger sync (if you want to force it instead of waiting for automatic one)
        // syncObj.Start();
    }

    // Wait until sync finishes or timeout expires
    if (syncDoneEvent.WaitOne(timeout))
    {
        syncCompleted = true;
    }
    else
    {
        syncCompleted = false;
    }
}
catch
{
    syncCompleted = false;
}

output = syncCompleted ? "True" : "False";
