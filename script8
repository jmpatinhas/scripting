// UiPath Invoke Code Activity - Simple Outlook Sync Monitor
// Output variable: syncResult (String)

DateTime startTime = DateTime.Now;
TimeSpan timeout = TimeSpan.FromMinutes(5);
bool outlookSynced = false;

while (DateTime.Now - startTime < timeout)
{
    System.Diagnostics.Process[] outlookProcesses = System.Diagnostics.Process.GetProcessesByName("OUTLOOK");
    
    if (outlookProcesses.Length == 0)
    {
        syncResult = "False";
        break;
    }
    
    string windowTitle = outlookProcesses[0].MainWindowTitle;
    
    if (windowTitle.Contains("All folders are up to date") || 
        (!windowTitle.Contains("Synchronizing") && 
         !windowTitle.Contains("Syncing") && 
         !windowTitle.Contains("Downloading")))
    {
        outlookSynced = true;
        break;
    }
    
    System.Threading.Thread.Sleep(2000);
}

syncResult = outlookSynced ? "True" : "False";
