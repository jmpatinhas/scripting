Dim startTime As DateTime = DateTime.Now
Dim maxWaitTime As TimeSpan = TimeSpan.FromMinutes(5)

While DateTime.Now - startTime < maxWaitTime
    Try
        Dim outlookApp As New Microsoft.Office.Interop.Outlook.Application
        Dim session As Microsoft.Office.Interop.Outlook.NameSpace = outlookApp.Session
        Dim anySyncRunning As Boolean = False
        
        For Each syncObj As Microsoft.Office.Interop.Outlook.SyncObject In session.SyncObjects
            Dim isRunning As Object = syncObj.GetType().InvokeMember("IsRunning", System.Reflection.BindingFlags.GetProperty, Nothing, syncObj, Nothing)
            If CBool(isRunning) = True Then
                anySyncRunning = True
                Exit For
            End If
        Next
        
        If Not anySyncRunning Then
            output = "true"
            Exit While
        End If
        
        System.Threading.Thread.Sleep(3000)
        
    Catch ex As Exception
        output = "true"
        Exit While
    End Try
End While

If output <> "true" Then
    output = "false"
End If
